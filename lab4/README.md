# 4 Лабораторная (обычная)
## 1. Задачи
- Написать “плохой” CI/CD файл, который работает, но в нем есть не менее пяти “bad practices” по написанию CI/CD
- Написать “хороший” CI/CD, в котором эти плохие практики исправлены
- В Readme описать каждую из плохих практик в плохом файле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат


## 2. Ход работы
### 2.1. "Плохой" CI/CD файл (bad.yml)
![image](https://github.com/user-attachments/assets/45c2e30c-4b01-4372-bca4-78e8d6c9f059)

В "плохом" CI/CD файле присутсвуют следующие "bad practices"
- Отсутствие подписей шагов: Здесь каждый шаг выполняется без поясняющих подписей. Это затрудняет восприятие процесса.
- Использование ubuntu-latest: Версия Ubuntu может неожиданно изменяться, что может привести к проблемам совместимости.
- Отсутствие связи между build и test: Тесты могут запуститься независимо от того, завершена ли сборка.
- Отсутствие кэширования: Зависимости устанавливаются заново при каждом запуске, что замедляет процесс.

### 2.2. "Хороший" CI/CD файл (good.yml)
![image](https://github.com/user-attachments/assets/0d1f0ac6-2e26-4288-93cf-fd101e512ded)


В этом файле были исправлены вышеуказанные недостатки следующим образом.
- Использование ubuntu-22.04: Это позволяет обеспечить стабильность и производительность, так как версия системы не будет неожиданно изменяться.
- Подписи шагов: Каждому шагу присвоены понятные и информативные подписи, что делает конфигурацию более читаемой.
- Связь между build и test: Включение needs: build в задаче test гарантирует, что тесты начнутся только после успешной сборки.
- Кэширование зависимостей: Добавлен шаг кэширования зависимостей pip, чтобы ускорить процессы в будущем, избегая повторной установки зависимостей.



# 4 Лабораторная (*)
## 1. Задачи
- Сделать красиво работу с секретами.

## 2. Ход работы

В виде хранилича секретов был выбран Vault от компании hashicorp.

### 2.1 Установка Vault

Для начала был скачан архив с exe файлом:

![image](https://github.com/user-attachments/assets/123741a7-36e9-402d-bc3a-dd39bb7552b6)

Потом был проверен и запучен сервер vault в dev режиме:

![image](https://github.com/user-attachments/assets/0aa4a1b6-fba5-4d47-bf62-24f82450598c)

![image](https://github.com/user-attachments/assets/72026ce5-1519-4002-bb24-b7fd6b56675f)

### 2.2 Создание секретов

В графическом интерфейсе vault по адресу localhost:8200 был создано новое храниличе секретов github-actions, а внем новый секрет MY_SECRET_KEY:

![image](https://github.com/user-attachments/assets/3170a820-cd54-40bc-aae9-895dcdef6e6b)

![image](https://github.com/user-attachments/assets/52fee899-62f6-428d-aa5f-4ba83ba8ab29)

### 2.3 Проброс портов

С помощью ngrok был проброшен порт с локальной машины localhost:8200 в интернет, для того чтобы мы смогли обратиться к нему из github

![image](https://github.com/user-attachments/assets/736c49a3-7ab0-48b7-a91a-5c18988a67d5)

### 2.4 локальная проверка

С помощью команды .\vault.exe kv get -field=MY_SECRET_KEY github-actions/MY_SECRET_KEY и уже заранее установленных переменных среды была произведена локальная проверка получения секрета из vault

![image](https://github.com/user-attachments/assets/bdf59a1f-4ba8-49b0-8e4b-27d6a59c9d98)

### 2.5 Получение секрета в github actions

Был изменен файл ci/cd secret.yml:

1) Был добавлен шаг установки vault

![image](https://github.com/user-attachments/assets/d14ddfb2-6d35-472b-b27f-3f8cba207a01)

2) Добавлено получение секрета из vault

![image](https://github.com/user-attachments/assets/07759307-f8c2-4109-aff7-8096a8eec5f4)

## Почему используются Vault?

1. **Безопасное хранение секретов**: Vault обеспечивает централизованное и зашифрованное хранилище для конфиденциальных данных, таких как пароли, ключи API и токены, предотвращая их утечку или несанкционированный доступ.

2. **Динамическое управление доступом**: Vault позволяет управлять доступом к секретам на основе политик, автоматически обновлять, отзывать или ротацию данных, что упрощает поддержание безопасности в динамичных средах.

3. **Аудит и контроль доступа**: Vault ведет подробные журналы аудита для всех операций с секретами, позволяя отслеживать, кто и когда обращался к данным, и обеспечивая соответствие нормативным требованиям.

## Почему хранение секретов в CI/CD переменных репозитория — плохая практика?

1. **Риски утечек**: Секреты могут быть доступны для всех пользователей с доступом к репозиторию, что увеличивает риск их утечки.
2. **Отсутствие шифрования**: В некоторых системах CI/CD секреты могут храниться в открытом виде.
3. **Проблемы с логами**: Секреты могут быть случайно выведены в логи, что создаёт дополнительные риски.
4. **Трудности в управлении**: Обновление и управление секретами становится сложным в случае множества переменных и репозиториев.

Использование GitHub Secrets помогает решить эти проблемы и сделать работу с секретами безопасной и удобной.


